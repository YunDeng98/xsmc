
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exact SMC Simulations &#8212; xsmc 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bayesian vs MAP" href="simulation.html" />
    <link rel="prev" title="Reproducible figures and tables from paper" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="simulation.html" title="Bayesian vs MAP"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Reproducible figures and tables from paper"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xsmc 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Reproducible figures and tables from paper</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Exact SMC Simulations</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="k">import</span> <span class="n">expm</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="k">import</span> <span class="n">factorial</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">PPoly</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">sem</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">msprime</span> <span class="k">as</span> <span class="nn">msp</span>
<span class="kn">import</span> <span class="nn">stdpopsim</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
    <span class="s1">&#39;text.usetex&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">})</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;../../../exact_decoding_paper/figures/prior/&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="Exact-SMC-Simulations">
<h1>Exact SMC Simulations<a class="headerlink" href="#Exact-SMC-Simulations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Simulation-1:-Comparing-renewal-prior-with-Markov-prior">
<h2>Simulation 1: Comparing renewal prior with Markov prior<a class="headerlink" href="#Simulation-1:-Comparing-renewal-prior-with-Markov-prior" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Define-necessary-functions-for-simulations">
<h3>Define necessary functions for simulations<a class="headerlink" href="#Define-necessary-functions-for-simulations" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_expected_coal_times</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">eta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">times</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
    <span class="c1"># the exact formula is numerically unstable for small r, so use a taylor expansion.</span>
    <span class="n">r_small</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="mi">12</span>
    <span class="n">r_normal</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">r</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">dt</span><span class="p">))</span>
    <span class="n">ary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">r_small</span><span class="p">,</span> <span class="n">r_normal</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ary</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">eta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]])</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">def</span> <span class="nf">get_emissions</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">ect</span><span class="p">,</span> <span class="n">w_end</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">site_locations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">position</span><span class="p">)</span><span class="o">//</span><span class="n">w</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">variants</span><span class="p">()]</span>
    <span class="n">loc</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">site_locations</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">w_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L_w</span><span class="p">)</span>
        <span class="n">not_last</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">not_last</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">w_end</span><span class="p">]</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">ect</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L_w</span><span class="p">)</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">w</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">ect</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="n">counts</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

    <span class="n">emissions</span> <span class="o">=</span> <span class="p">(</span><span class="n">outer</span> <span class="o">**</span> <span class="n">counts</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">outer</span><span class="p">)</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">counts</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">emissions</span>

<span class="k">def</span> <span class="nf">initial_distribution</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">times</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">PPoly</span><span class="p">(</span><span class="n">eta</span><span class="p">[</span><span class="kc">None</span><span class="p">,:],</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">antiderivative</span><span class="p">()</span>
    <span class="n">cdf_vals</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)])</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">cdf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">cdf_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">stationary_distribution</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
    <span class="n">N0</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">eta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vt</span> <span class="o">=</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">N0</span>
    <span class="n">times_scaled</span> <span class="o">=</span> <span class="n">times</span> <span class="o">/</span> <span class="n">N0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">times_scaled</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">PPoly</span><span class="p">(</span><span class="n">vt</span><span class="p">[</span><span class="kc">None</span><span class="p">,:],</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">antiderivative</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">exp_int</span><span class="p">(</span><span class="n">tau</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Y</span><span class="p">(</span><span class="n">tau</span><span class="p">))</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">exp_int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp_int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">denominator</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)]</span>
    <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">quad</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times_scaled</span><span class="p">]),</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">cdf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">cdf_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">get_transitions_Markov</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">times</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">PPoly</span><span class="p">(</span><span class="n">eta</span><span class="p">[</span><span class="kc">None</span><span class="p">,:],</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">antiderivative</span><span class="p">()</span>

    <span class="n">A_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">A_rho</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">A_rho</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">A_eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">A_eta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">A_eta</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">e_j</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">A_rho</span> <span class="o">+</span> <span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="o">*</span><span class="n">A_eta</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">e_j</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">e_j</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">s</span><span class="p">])))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">-</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">e_k1</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">A_rho</span> <span class="o">+</span> <span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">A_eta</span><span class="p">)</span>
            <span class="n">e_k2</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">A_rho</span> <span class="o">+</span> <span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">A_eta</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">e_k1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_k2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">e_k3</span> <span class="o">=</span> <span class="n">expm</span><span class="p">((</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">A_rho</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">-</span> <span class="n">Y</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="n">A_eta</span><span class="p">)</span>

                <span class="n">p</span> <span class="o">=</span> <span class="n">e_k1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">+=</span> <span class="n">e_k2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">e_k3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">p</span>

    <span class="n">transitions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">T</span><span class="p">:</span>
                <span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">transitions</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_transitions_Renewal</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ect</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
<span class="c1">#     rows = stationary_distribution(times, eta)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">initial_distribution</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">rho</span><span class="o">*</span><span class="n">ect</span><span class="p">)</span>
    <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rho</span><span class="o">*</span><span class="n">ect</span><span class="p">)</span>
    <span class="n">transitions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">diag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transitions</span>

<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init_dist</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_dist</span> <span class="o">*</span> <span class="n">emissions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">L_w</span><span class="p">)</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">L_w</span><span class="p">):</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">transitions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">c</span>

<span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">beta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L_w</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">emissions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">transitions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">beta</span>

<span class="k">def</span> <span class="nf">get_posterior</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init_dist</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">):</span>
    <span class="n">alpha</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">forward</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init_dist</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">backward</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">beta</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_viterbi</span><span class="p">(</span><span class="n">log_T</span><span class="p">,</span> <span class="n">log_B</span><span class="p">,</span> <span class="n">log_pi</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_pi</span><span class="p">)</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">L</span><span class="p">,</span> <span class="n">K</span><span class="p">])</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">L</span><span class="p">,</span> <span class="n">K</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_pi</span> <span class="o">+</span> <span class="n">log_B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="p">):</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_T</span> <span class="o">+</span> <span class="n">log_B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">Z</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">T1</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Z</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">Z</span>

<span class="k">def</span> <span class="nf">run_sim</span><span class="p">(</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">de</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">L_w</span> <span class="o">=</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span>

    <span class="n">gammas_Markov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">gammas_Renewal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">viterbis_Markov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">viterbis_Renewal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">tss</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">init_dist</span> <span class="o">=</span> <span class="n">initial_distribution</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
    <span class="n">ect</span> <span class="o">=</span> <span class="n">get_expected_coal_times</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
    <span class="n">transitions_Markov</span> <span class="o">=</span> <span class="n">get_transitions_Markov</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
    <span class="n">transitions_Renewal</span> <span class="o">=</span> <span class="n">get_transitions_Renewal</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ect</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sim</span><span class="p">):</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">msp</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">Ne</span><span class="o">=</span><span class="n">N0</span><span class="p">,</span>
                          <span class="n">mutation_rate</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span>
                          <span class="n">recombination_rate</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
                          <span class="n">sample_size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                          <span class="n">length</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                          <span class="n">random_seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                          <span class="n">demographic_events</span><span class="o">=</span><span class="n">de</span><span class="p">)</span>
        <span class="n">tss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

        <span class="n">emissions</span> <span class="o">=</span> <span class="n">get_emissions</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">ect</span><span class="p">)</span>


        <span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_posterior</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init_dist</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions_Markov</span><span class="p">)</span>
        <span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_posterior</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init_dist</span><span class="p">,</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions_Renewal</span><span class="p">)</span>
        <span class="n">viterbis_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_viterbi</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transitions_Markov</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emissions</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">init_dist</span><span class="p">),</span> <span class="n">L_w</span><span class="p">)</span>
        <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_viterbi</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transitions_Renewal</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emissions</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">init_dist</span><span class="p">),</span> <span class="n">L_w</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gammas_Markov</span><span class="p">,</span> <span class="n">gammas_Renewal</span><span class="p">,</span> <span class="n">viterbis_Markov</span><span class="p">,</span> <span class="n">viterbis_Renewal</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">ect</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Functions-to-plot-results">
<h3>Functions to plot results<a class="headerlink" href="#Functions-to-plot-results" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_viterbi</span><span class="p">(</span><span class="n">viterbis_Markov</span><span class="p">,</span> <span class="n">viterbis_renewal</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">L_w</span> <span class="o">=</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span>
    <span class="n">scale_to_kb</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">w</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">plot_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;Constant, Low $\rho$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Expansion, Low $\rho$&#39;</span><span class="p">,</span>
                   <span class="sa">r</span><span class="s1">&#39;Constant, High $\rho$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Expansion, High $\rho$&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>
        <span class="n">ect</span> <span class="o">=</span> <span class="n">ects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">pmap</span> <span class="o">=</span> <span class="n">viterbis_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>
        <span class="n">dpmap</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dpmap</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ect</span><span class="p">[</span><span class="n">pmap</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-pre&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Markov&#39;</span><span class="p">)</span>

        <span class="n">pmap</span> <span class="o">=</span> <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>
        <span class="n">dpmap</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dpmap</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ect</span><span class="p">[</span><span class="n">pmap</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-pre&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Renewal&#39;</span><span class="p">)</span>


        <span class="n">truth</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">truth</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">L_w</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-post&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">})</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="n">plot_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">/</span> <span class="n">scale_to_kb</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylow</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ylow</span>

            <span class="n">yhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yhigh</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">yhigh</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (kb)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coalescence time (Generations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_posterior</span><span class="p">(</span><span class="n">gammas_Markov</span><span class="p">,</span> <span class="n">gammas_Renewal</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">L_w</span> <span class="o">=</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span>
    <span class="n">scale_to_kb</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">w</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">plot_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;Constant, Low $\rho$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Expansion, Low $\rho$&#39;</span><span class="p">,</span>
                   <span class="sa">r</span><span class="s1">&#39;Constant, High $\rho$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Expansion, High $\rho$&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="n">plot_labels</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span>
        <span class="n">ect</span> <span class="o">=</span> <span class="n">ects</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">truth</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">truth</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">L_w</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-post&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">L_w</span><span class="p">),</span> <span class="n">ect</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">gamma</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span><span class="o">//</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_w</span> <span class="o">/</span> <span class="n">scale_to_kb</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylow</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ylow</span>

            <span class="n">yhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yhigh</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">yhigh</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (kb)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coalescence time (Generations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Functions-to-create-tables">
<h3>Functions to create tables<a class="headerlink" href="#Functions-to-create-tables" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_truth</span><span class="p">(</span><span class="n">tss</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span>
    <span class="n">num_sim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tss</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sequence_length</span>
    <span class="n">L_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span> <span class="o">//</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">tmrca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">L_w</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tss</span><span class="p">)):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cts</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">),</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cts</span><span class="p">)):</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">epoch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">times</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">truth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">,</span> <span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">tmrca</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">tmrca</span><span class="p">,</span> <span class="n">truth</span>

<span class="k">def</span> <span class="nf">get_mean_se</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">num_pos</span><span class="p">):</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gammas</span> <span class="o">*</span> <span class="n">dist</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">num_pos</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">sem</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">se</span>

<span class="k">def</span> <span class="nf">save_table</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">]</span>
    <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Scenario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_list</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">dec_places</span><span class="p">):</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;{mean:.</span><span class="si">{dec_places}</span><span class="s1">f} ({se:.</span><span class="si">{dec_places}</span><span class="s1">f})&#39;</span>
    <span class="k">return</span> <span class="n">entry</span>

<span class="n">mfunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">format_entry</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Create containers for all 4 scenarios</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gammas_Markov</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">gammas_Renewal</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">viterbis_Markov</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">viterbis_Renewal</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">tss</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>

<span class="c1">#These parameters are the same for each scenario</span>
<span class="n">num_sim</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1">#number of simulation runs</span>
<span class="n">N0</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="c1">#base effective population size</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.4e-8</span> <span class="c1">#mutation rate</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">5_000_000</span> <span class="c1">#sequence length</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#sample size</span>

<span class="n">w</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">#window size</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Scenario-1">
<h3>Scenario 1<a class="headerlink" href="#Scenario-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Constant population (N=1e4)</p></li>
<li><p>mutation rate = 1.4e-8</p></li>
<li><p>recombination rate = 1e-9</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N0</span><span class="p">),</span> <span class="n">T</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">w</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">run_sim</span><span class="p">(</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
<span class="n">gammas_Markov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">viterbis_Markov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ect_constant</span> <span class="o">=</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:186: RuntimeWarning: divide by zero encountered in log
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:187: RuntimeWarning: divide by zero encountered in log
</pre></div></div>
</div>
</div>
<div class="section" id="Scenario-2">
<h3>Scenario 2<a class="headerlink" href="#Scenario-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Population Expansion in the recent past (N=1e6 at time=0, N=5e-5 at time 1000, N=1e-4 at time 3000)</p></li>
<li><p>mutation rate = 1.4e-8</p></li>
<li><p>recombination rate = 1e-9</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">eta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">200</span> <span class="o">*</span> <span class="n">N0</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N0</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="mi">16</span><span class="p">)]</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">w</span>

<span class="c1">#Add demographic event for variable population size</span>
<span class="n">de</span> <span class="o">=</span> <span class="p">[</span><span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">initial_size</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">N0</span><span class="p">),</span>
        <span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">initial_size</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">N0</span><span class="p">),</span>
        <span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">initial_size</span><span class="o">=</span><span class="n">N0</span><span class="p">)]</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">run_sim</span><span class="p">(</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">de</span><span class="p">)</span>
<span class="n">gammas_Markov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">viterbis_Markov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ect_variable</span> <span class="o">=</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:186: RuntimeWarning: divide by zero encountered in log
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:187: RuntimeWarning: divide by zero encountered in log
</pre></div></div>
</div>
</div>
<div class="section" id="Scenario-3">
<h3>Scenario 3<a class="headerlink" href="#Scenario-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Constant population (N=1e4)</p></li>
<li><p>mutation rate = 1.4e-8</p></li>
<li><p>recombination rate = 1.4e-8</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1.4e-8</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N0</span><span class="p">),</span> <span class="n">T</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">w</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">run_sim</span><span class="p">(</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
<span class="n">gammas_Markov</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">viterbis_Markov</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:186: RuntimeWarning: divide by zero encountered in log
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:187: RuntimeWarning: divide by zero encountered in log
</pre></div></div>
</div>
</div>
<div class="section" id="Scenario-4">
<h3>Scenario 4<a class="headerlink" href="#Scenario-4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Population Expansion in the recent past (N=1e6 at time=0, N=5e-5 at time 1000, N=1e-4 at time 3000)</p></li>
<li><p>mutation rate = 1.4e-8</p></li>
<li><p>recombination rate = 1.4e-8</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1.4e-8</span>
<span class="n">eta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">200</span> <span class="o">*</span> <span class="n">N0</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N0</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="mi">16</span><span class="p">)]</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">w</span>

<span class="c1">#Add demographic event for variable population size</span>
<span class="n">de</span> <span class="o">=</span> <span class="p">[</span><span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">initial_size</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">N0</span><span class="p">),</span>
        <span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">initial_size</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">N0</span><span class="p">),</span>
        <span class="n">msp</span><span class="o">.</span><span class="n">PopulationParametersChange</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">initial_size</span><span class="o">=</span><span class="n">N0</span><span class="p">)]</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">run_sim</span><span class="p">(</span><span class="n">num_sim</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">de</span><span class="p">)</span>
<span class="n">gammas_Markov</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">viterbis_Markov</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">viterbis_Renewal</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tss</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:186: RuntimeWarning: divide by zero encountered in log
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:187: RuntimeWarning: divide by zero encountered in log
</pre></div></div>
</div>
</div>
<div class="section" id="Plot-Viterbi-and-posterior-for-one-run-under-each-scenario">
<h3>Plot Viterbi and posterior for one run under each scenario<a class="headerlink" href="#Plot-Viterbi-and-posterior-for-one-run-under-each-scenario" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_seed</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">ects</span><span class="o">=</span> <span class="p">[</span><span class="n">ect_constant</span><span class="p">,</span> <span class="n">ect_variable</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="o">/</span><span class="mf">1.4e-8</span>
<span class="n">plot_viterbi</span><span class="p">(</span><span class="n">viterbis_Markov</span><span class="p">,</span> <span class="n">viterbis_Renewal</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">plot_seed</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="s1">&#39;viterbi1.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_prior_simulation_20_0.png" src="../_images/paper_prior_simulation_20_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">gammas_Markov</span><span class="p">,</span> <span class="n">gammas_Renewal</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">plot_seed</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="s1">&#39;posterior1.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_prior_simulation_21_0.png" src="../_images/paper_prior_simulation_21_0.png" />
</div>
</div>
</div>
<div class="section" id="Creating-tables">
<h3>Creating tables<a class="headerlink" href="#Creating-tables" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;Renewal&#39;</span><span class="p">]</span>
<span class="n">df_abs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">tmrca</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="n">get_truth</span><span class="p">(</span><span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span>==0:
        <span class="n">dist_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ect_constant</span> <span class="o">-</span> <span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">])</span>
        <span class="n">dist_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ect_constant</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dist_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ect_variable</span> <span class="o">-</span> <span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">])</span>
        <span class="n">dist_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ect_variable</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]))</span>

    <span class="n">mean1</span><span class="p">,</span> <span class="n">se1</span> <span class="o">=</span> <span class="n">get_mean_se</span><span class="p">(</span><span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dist_abs</span><span class="p">,</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">mean2</span><span class="p">,</span> <span class="n">se2</span> <span class="o">=</span> <span class="n">get_mean_se</span><span class="p">(</span><span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dist_abs</span><span class="p">,</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">mean3</span><span class="p">,</span> <span class="n">se3</span> <span class="o">=</span> <span class="n">get_mean_se</span><span class="p">(</span><span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dist_log</span><span class="p">,</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">mean4</span><span class="p">,</span> <span class="n">se4</span> <span class="o">=</span> <span class="n">get_mean_se</span><span class="p">(</span><span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dist_log</span><span class="p">,</span> <span class="n">L</span> <span class="o">//</span> <span class="n">w</span><span class="p">)</span>

    <span class="n">df_abs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{mean1:.2f}</span><span class="s1"> (</span><span class="si">{se1:.2f}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{mean2:.2f}</span><span class="s1"> (</span><span class="si">{se2:.2f}</span><span class="s1">)&#39;</span><span class="p">]</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{mean3:.4f}</span><span class="s1"> (</span><span class="si">{se3:.4f}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{mean4:.4f}</span><span class="s1"> (</span><span class="si">{se4:.4f}</span><span class="s1">)&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">save_table</span><span class="p">(</span><span class="n">df_abs</span><span class="p">,</span> <span class="s1">&#39;table1_1.tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Scenario</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Markov</th>
      <td>6075.50 (215.59)</td>
      <td>5187.24 (187.27)</td>
      <td>12037.25 (298.71)</td>
      <td>12112.81 (106.44)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <td>6068.04 (209.11)</td>
      <td>5187.49 (184.34)</td>
      <td>11476.92 (282.36)</td>
      <td>11571.28 (97.99)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">save_table</span><span class="p">(</span><span class="n">df_log</span><span class="p">,</span> <span class="s1">&#39;table1_2.tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Scenario</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Markov</th>
      <td>0.1362 (0.0035)</td>
      <td>0.1281 (0.0024)</td>
      <td>0.3051 (0.0013)</td>
      <td>0.3006 (0.0014)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <td>0.1437 (0.0026)</td>
      <td>0.1359 (0.0025)</td>
      <td>0.3451 (0.0046)</td>
      <td>0.3422 (0.0014)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;Q1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Renewal&#39;</span><span class="p">,</span> <span class="s1">&#39;Q1&#39;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Renewal&#39;</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;Q3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Renewal&#39;</span><span class="p">,</span> <span class="s1">&#39;Q3&#39;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="s1">&#39;Markov&#39;</span><span class="p">,</span> <span class="s1">&#39;Q4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Renewal&#39;</span><span class="p">,</span> <span class="s1">&#39;Q4&#39;</span><span class="p">)])</span>
<span class="n">df_abs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_sim</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_row</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">dec_places</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">sem</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;{m:.</span><span class="si">{dec_places}</span><span class="s1">f} ({s:.</span><span class="si">{dec_places}</span><span class="s1">f})&#39;</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">se</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">row</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">df_abs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">tmrca</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="n">get_truth</span><span class="p">(</span><span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
    <span class="n">l11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">l12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">l13</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">l14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_sim</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">2</span>==0:
        <span class="n">dist_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ect_constant</span> <span class="o">-</span> <span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">])</span>
        <span class="n">dist_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ect_constant</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dist_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ect_variable</span> <span class="o">-</span> <span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">])</span>
        <span class="n">dist_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ect_variable</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmrca</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]))</span>


    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sim</span><span class="p">):</span>
        <span class="n">full_Markov_abs</span> <span class="o">=</span> <span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist_abs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">full_Renewal_abs</span> <span class="o">=</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist_abs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">full_Markov_log</span> <span class="o">=</span> <span class="n">gammas_Markov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">full_Renewal_log</span> <span class="o">=</span> <span class="n">gammas_Renewal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">uniq_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmrca</span><span class="p">)</span>
        <span class="n">breaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">uniq_t</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">inds_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmrca</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">breaks</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmrca</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">breaks</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inds_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmrca</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">breaks</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

            <span class="n">num_pos</span> <span class="o">=</span> <span class="n">inds_k</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_pos</span>
            <span class="n">l11</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_Markov_abs</span><span class="p">[</span><span class="n">inds_k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">num_pos</span>
            <span class="n">l12</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_Renewal_abs</span><span class="p">[</span><span class="n">inds_k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">num_pos</span>
            <span class="n">l13</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_Markov_log</span><span class="p">[</span><span class="n">inds_k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">num_pos</span>
            <span class="n">l14</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_Renewal_log</span><span class="p">[</span><span class="n">inds_k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">num_pos</span>

    <span class="n">df_abs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_row</span><span class="p">(</span><span class="n">l11</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">df_abs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_row</span><span class="p">(</span><span class="n">l12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_row</span><span class="p">(</span><span class="n">l13</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_row</span><span class="p">(</span><span class="n">l14</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">se</span> <span class="o">=</span> <span class="n">sem</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">mfunc</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">,</span> <span class="s1">&#39;Q3&#39;</span><span class="p">,</span> <span class="s1">&#39;Q4&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Scenario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;locicounts.tex&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Scenario</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Q1</th>
      <td>25878.20 (951.37)</td>
      <td>28103.76 (1075.15)</td>
      <td>27807.96 (580.26)</td>
      <td>27659.64 (233.24)</td>
    </tr>
    <tr>
      <th>Q2</th>
      <td>12037.56 (646.81)</td>
      <td>10589.40 (702.38)</td>
      <td>10931.92 (331.94)</td>
      <td>11149.32 (143.83)</td>
    </tr>
    <tr>
      <th>Q3</th>
      <td>7917.24 (461.61)</td>
      <td>7231.24 (509.98)</td>
      <td>7200.76 (178.59)</td>
      <td>7119.12 (95.21)</td>
    </tr>
    <tr>
      <th>Q4</th>
      <td>4167.00 (360.71)</td>
      <td>4075.60 (272.09)</td>
      <td>4059.36 (124.89)</td>
      <td>4071.92 (90.72)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">save_table</span><span class="p">(</span><span class="n">df_abs</span><span class="p">,</span> <span class="s1">&#39;table1_3.tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Markov</th>
      <th>Q1</th>
      <td>2840.79 (124.42)</td>
      <td>2219.61 (101.38)</td>
      <td>6820.01 (245.65)</td>
      <td>6672.23 (88.84)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q1</th>
      <td>2887.14 (129.53)</td>
      <td>2273.91 (100.00)</td>
      <td>5292.75 (180.86)</td>
      <td>5256.89 (55.12)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q2</th>
      <td>6524.06 (131.61)</td>
      <td>6106.74 (122.89)</td>
      <td>13346.56 (35.50)</td>
      <td>13465.23 (57.68)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q2</th>
      <td>6604.09 (117.57)</td>
      <td>6123.72 (107.90)</td>
      <td>11463.27 (38.05)</td>
      <td>11665.01 (35.60)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q3</th>
      <td>10543.82 (239.47)</td>
      <td>9716.04 (219.67)</td>
      <td>18831.10 (64.05)</td>
      <td>18957.97 (67.16)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q3</th>
      <td>10454.31 (249.99)</td>
      <td>9528.27 (225.84)</td>
      <td>19538.07 (72.65)</td>
      <td>19682.76 (71.76)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q4</th>
      <td>17242.02 (460.92)</td>
      <td>16362.35 (471.86)</td>
      <td>33016.17 (212.12)</td>
      <td>33526.33 (226.10)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q4</th>
      <td>16959.09 (505.93)</td>
      <td>16341.50 (601.40)</td>
      <td>40181.58 (263.39)</td>
      <td>40141.12 (279.70)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">save_table</span><span class="p">(</span><span class="n">df_log</span><span class="p">,</span> <span class="s1">&#39;table1_4.tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Markov</th>
      <th>Q1</th>
      <td>0.1479 (0.0056)</td>
      <td>0.1328 (0.0033)</td>
      <td>0.3212 (0.0020)</td>
      <td>0.3080 (0.0022)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q1</th>
      <td>0.1563 (0.0045)</td>
      <td>0.1413 (0.0034)</td>
      <td>0.3299 (0.0057)</td>
      <td>0.3119 (0.0018)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q2</th>
      <td>0.1279 (0.0023)</td>
      <td>0.1253 (0.0023)</td>
      <td>0.2755 (0.0016)</td>
      <td>0.2863 (0.0016)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q2</th>
      <td>0.1373 (0.0024)</td>
      <td>0.1336 (0.0024)</td>
      <td>0.3277 (0.0019)</td>
      <td>0.3480 (0.0022)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q3</th>
      <td>0.1255 (0.0029)</td>
      <td>0.1242 (0.0036)</td>
      <td>0.2826 (0.0020)</td>
      <td>0.2857 (0.0022)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q3</th>
      <td>0.1324 (0.0033)</td>
      <td>0.1293 (0.0039)</td>
      <td>0.3769 (0.0024)</td>
      <td>0.3857 (0.0024)</td>
    </tr>
    <tr>
      <th>Markov</th>
      <th>Q4</th>
      <td>0.1197 (0.0036)</td>
      <td>0.1216 (0.0032)</td>
      <td>0.3168 (0.0026)</td>
      <td>0.3178 (0.0021)</td>
    </tr>
    <tr>
      <th>Renewal</th>
      <th>Q4</th>
      <td>0.1247 (0.0040)</td>
      <td>0.1278 (0.0036)</td>
      <td>0.4546 (0.0029)</td>
      <td>0.4568 (0.0023)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Simulation-2:-Effect-of-Demographic-Prior">
<h2>Simulation 2: Effect of Demographic Prior<a class="headerlink" href="#Simulation-2:-Effect-of-Demographic-Prior" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Redefine-some-functions-for-second-simulation">
<h3>Redefine some functions for second simulation<a class="headerlink" href="#Redefine-some-functions-for-second-simulation" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_viterbi</span><span class="p">(</span><span class="n">viterbis</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">scale_to_kb</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">w</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">3600</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Zigzag&#39;</span><span class="p">,</span> <span class="s1">&#39;Constant&#39;</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">ect</span> <span class="o">=</span> <span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">pmap</span> <span class="o">=</span> <span class="n">viterbis</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">dpmap</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dpmap</span><span class="p">,</span> <span class="n">L_w</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ect</span><span class="p">[</span><span class="n">pmap</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-pre&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="n">truth</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">truth</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">L_w</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-post&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">})</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">width</span><span class="p">])</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">width</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">width</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ylow</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ylow</span>

            <span class="n">yhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">width</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">yhigh</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">yhigh</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="n">scale_to_kb</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (kb)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coalescence time (Generations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_posterior</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">scale_to_kb</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">w</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">3600</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Zigzag&#39;</span><span class="p">,</span> <span class="s1">&#39;Constant&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">i</span><span class="o">//</span><span class="mi">3</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>

        <span class="n">ind2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">ind2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">ind1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="n">ect</span> <span class="o">=</span> <span class="n">ects</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">gammas</span><span class="p">[</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,:</span><span class="n">width</span><span class="p">]</span>

        <span class="n">truth</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">truth</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">L_w</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s2">&quot;steps-post&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">ect</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="n">scale_to_kb</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">gamma</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#         if unique_clim:</span>
<span class="c1">#             im.set_clim(np.amin(gamma), np.amax(gamma))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylow</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ylow</span>

            <span class="n">yhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yhigh</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">yhigh</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="n">scale_to_kb</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (kb)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coalescence time (Generations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_truth</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">tss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sequence_length</span>
    <span class="n">L_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="n">w</span><span class="p">))</span>
    <span class="n">tmrca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">L_w</span><span class="p">)</span>

    <span class="n">cts</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">),</span>
            <span class="nb">round</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">w</span><span class="p">),</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">get_tmrca</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cts</span><span class="p">)):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">tmrca</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">tmrca</span><span class="p">,</span> <span class="n">truth</span>

<span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="s1">&#39;Zigzag&#39;</span><span class="p">,</span> <span class="s1">&#39;Constant&#39;</span><span class="p">]</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">sem</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">dec_places</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dec_places</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">mfunc</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">dec_places</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Set-simulation-and-model-parameters">
<h3>Set simulation and model parameters<a class="headerlink" href="#Set-simulation-and-model-parameters" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">num_sim</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">species</span> <span class="o">=</span> <span class="n">stdpopsim</span><span class="o">.</span><span class="n">get_species</span><span class="p">(</span><span class="s2">&quot;HomSap&quot;</span><span class="p">)</span>
<span class="n">chrom</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">contig</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">get_contig</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;chr</span><span class="si">{chrom}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">contig</span><span class="o">.</span><span class="n">recombination_map</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">contig</span><span class="o">.</span><span class="n">mutation_rate</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">plot_seed</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">africa</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">get_demographic_model</span><span class="p">(</span><span class="s2">&quot;Africa_1T12&quot;</span><span class="p">)</span>
<span class="n">zigzag</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">get_demographic_model</span><span class="p">(</span><span class="s2">&quot;Zigzag_1S14&quot;</span><span class="p">)</span>
<span class="n">constant</span> <span class="o">=</span> <span class="n">stdpopsim</span><span class="o">.</span><span class="n">PiecewiseConstantSize</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">population_size</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">africa</span><span class="p">,</span> <span class="n">zigzag</span><span class="p">,</span> <span class="n">constant</span><span class="p">]</span>

<span class="n">demo_africa</span> <span class="o">=</span> <span class="n">africa</span><span class="o">.</span><span class="n">get_demography_debugger</span><span class="p">()</span>
<span class="n">demo_zigzag</span> <span class="o">=</span> <span class="n">zigzag</span><span class="o">.</span><span class="n">get_demography_debugger</span><span class="p">()</span>

<span class="n">eta_africa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_africa</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">times</span><span class="p">)))</span>
<span class="n">eta_zigzag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_zigzag</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">times</span><span class="p">)))</span>
<span class="n">eta_constant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">species</span><span class="o">.</span><span class="n">population_size</span><span class="p">),</span> <span class="n">T</span><span class="p">)</span>
<span class="n">etas</span> <span class="o">=</span> <span class="p">[</span><span class="n">eta_africa</span><span class="p">,</span> <span class="n">eta_zigzag</span><span class="p">,</span> <span class="n">eta_constant</span><span class="p">]</span>

<span class="n">L</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">genome</span><span class="o">.</span><span class="n">chromosomes</span><span class="p">[</span><span class="n">chrom</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span>
<span class="n">L_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="n">w</span><span class="p">))</span>

<span class="n">w_end</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">%</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">w_end</span> <span class="o">=</span> <span class="n">L</span> <span class="o">%</span> <span class="n">w</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">w</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Population-size-trajectories">
<h3>Population size trajectories<a class="headerlink" href="#Population-size-trajectories" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_africa</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Africa&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_africa</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">times</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-post&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Africa Piecewise&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_zigzag</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Zigzag&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">demo_zigzag</span><span class="o">.</span><span class="n">population_size_trajectory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">times</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-post&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Zigzag Piecewise&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">species</span><span class="o">.</span><span class="n">population_size</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constant&#39;</span><span class="p">)</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (Generations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Effective Population Size&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;sizehistory.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_prior_simulation_39_0.png" src="../_images/paper_prior_simulation_39_0.png" />
</div>
</div>
</div>
<div class="section" id="Run-simulations">
<h3>Run simulations<a class="headerlink" href="#Run-simulations" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">ects</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">transitions</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>

<span class="n">gammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">L_w</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
<span class="n">viterbis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">L_w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">tss</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">stdpopsim</span><span class="o">.</span><span class="n">get_engine</span><span class="p">(</span><span class="s1">&#39;msprime&#39;</span><span class="p">)</span>

<span class="n">err_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">num_sim</span><span class="p">))</span>
<span class="n">err_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">num_sim</span><span class="p">))</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ids</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_distribution</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">etas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_expected_coal_times</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">etas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_transitions_Renewal</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">rho</span><span class="p">,</span> <span class="n">etas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sim</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">contig</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="n">plot_seed</span><span class="p">:</span>
            <span class="n">tss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

        <span class="n">tmrca</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="n">get_truth</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">emissions</span> <span class="o">=</span> <span class="n">get_emissions</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">w_end</span><span class="p">)</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">get_posterior</span><span class="p">(</span><span class="n">L_w</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">ids</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">emissions</span><span class="p">,</span> <span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">dist_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmrca</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])</span>
            <span class="n">dist_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ects</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmrca</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]))</span>
            <span class="n">err_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">dist_abs</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">L_w</span>
            <span class="n">err_B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">dist_log</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">L_w</span>

            <span class="k">if</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="n">plot_seed</span><span class="p">:</span>
                <span class="n">gammas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
                <span class="n">viterbis</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_viterbi</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emissions</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">L_w</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/caleb/Desktop/Git/HMM-EM/venv/lib/python3.7/site-packages/ipykernel_launcher.py:40: RuntimeWarning: divide by zero encountered in log
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 1
0 2
0 3
0 4
0 5
0 6
0 7
0 8
0 9
0 10
0 11
0 12
0 13
0 14
0 15
0 16
0 17
0 18
0 19
0 20
0 21
0 22
0 23
0 24
1 0
1 1
1 2
1 3
1 4
1 5
1 6
1 7
1 8
1 9
1 10
1 11
1 12
1 13
1 14
1 15
1 16
1 17
1 18
1 19
1 20
1 21
1 22
1 23
1 24
2 0
2 1
2 2
2 3
2 4
2 5
2 6
2 7
2 8
2 9
2 10
2 11
2 12
2 13
2 14
2 15
2 16
2 17
2 18
2 19
2 20
2 21
2 22
2 23
2 24
</pre></div></div>
</div>
</div>
<div class="section" id="Plot-results">
<h3>Plot results<a class="headerlink" href="#Plot-results" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_viterbi</span><span class="p">(</span><span class="n">viterbis</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;viterbi2.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_prior_simulation_43_0.png" src="../_images/paper_prior_simulation_43_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span> <span class="n">tss</span><span class="p">,</span> <span class="n">ects</span><span class="p">,</span> <span class="n">L_w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;posterior2.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_prior_simulation_44_1.png" src="../_images/paper_prior_simulation_44_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">create_table</span><span class="p">(</span><span class="n">err_A</span><span class="p">,</span> <span class="s1">&#39;table2_1.tex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Africa</th>
      <th>Zigzag</th>
      <th>Constant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Africa</th>
      <td>10144.40 (19.76)</td>
      <td>10359.75 (20.84)</td>
      <td>10663.13 (20.19)</td>
    </tr>
    <tr>
      <th>Zigzag</th>
      <td>5507.79 (132.03)</td>
      <td>4962.75 (120.63)</td>
      <td>5700.60 (137.21)</td>
    </tr>
    <tr>
      <th>Constant</th>
      <td>11584.24 (259.28)</td>
      <td>11764.86 (263.18)</td>
      <td>11898.49 (266.09)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">create_table</span><span class="p">(</span><span class="n">err_B</span><span class="p">,</span> <span class="s1">&#39;table2_2.tex&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Africa</th>
      <th>Zigzag</th>
      <th>Constant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Africa</th>
      <td>0.3293 (0.0004)</td>
      <td>0.3934 (0.0005)</td>
      <td>0.3549 (0.0004)</td>
    </tr>
    <tr>
      <th>Zigzag</th>
      <td>0.3678 (0.0041)</td>
      <td>0.3548 (0.0042)</td>
      <td>0.3788 (0.0038)</td>
    </tr>
    <tr>
      <th>Constant</th>
      <td>0.3496 (0.0068)</td>
      <td>0.3955 (0.0059)</td>
      <td>0.3679 (0.0064)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Exact SMC Simulations</a><ul>
<li><a class="reference internal" href="#Simulation-1:-Comparing-renewal-prior-with-Markov-prior">Simulation 1: Comparing renewal prior with Markov prior</a><ul>
<li><a class="reference internal" href="#Define-necessary-functions-for-simulations">Define necessary functions for simulations</a></li>
<li><a class="reference internal" href="#Functions-to-plot-results">Functions to plot results</a></li>
<li><a class="reference internal" href="#Functions-to-create-tables">Functions to create tables</a></li>
<li><a class="reference internal" href="#Scenario-1">Scenario 1</a></li>
<li><a class="reference internal" href="#Scenario-2">Scenario 2</a></li>
<li><a class="reference internal" href="#Scenario-3">Scenario 3</a></li>
<li><a class="reference internal" href="#Scenario-4">Scenario 4</a></li>
<li><a class="reference internal" href="#Plot-Viterbi-and-posterior-for-one-run-under-each-scenario">Plot Viterbi and posterior for one run under each scenario</a></li>
<li><a class="reference internal" href="#Creating-tables">Creating tables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Simulation-2:-Effect-of-Demographic-Prior">Simulation 2: Effect of Demographic Prior</a><ul>
<li><a class="reference internal" href="#Redefine-some-functions-for-second-simulation">Redefine some functions for second simulation</a></li>
<li><a class="reference internal" href="#Set-simulation-and-model-parameters">Set simulation and model parameters</a></li>
<li><a class="reference internal" href="#Population-size-trajectories">Population size trajectories</a></li>
<li><a class="reference internal" href="#Run-simulations">Run simulations</a></li>
<li><a class="reference internal" href="#Plot-results">Plot results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Reproducible figures and tables from paper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="simulation.html"
                        title="next chapter">Bayesian vs MAP</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/paper/prior_simulation.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="simulation.html" title="Bayesian vs MAP"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Reproducible figures and tables from paper"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xsmc 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Reproducible figures and tables from paper</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Exact SMC Simulations</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Caleb Ki and Jonathan Terhorst.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>